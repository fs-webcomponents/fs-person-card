<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../fs-client/fs-client.html">
<link rel="import" href="../fs-behavior/fs-behavior.html">
<link rel="import" href="../fs-person-portrait/fs-person-portrait.html">

<!--
A FamilySearch person card.

Example:

    <fs-person-card pid="PPP-PPPP"></fs-person-card>

@group FamilySearch Elements
@element fs-person-card
@demo demo/index.html
-->
<dom-module id="fs-person-card">
  <link rel="import" type="css" href="fs-person-card.css">
  <template>
    <fs-client name="{{clientName}}" on-authenticated-changed="_authenticatedChanged"></fs-client>
    <fs-person-portrait id="portrait"></fs-person-portrait>
    <div class="header">Loading...</div>
    <img class="loader" src="ajax-loader.gif" />
    <div class="details">
      <div class="pid"></div>
      <div class="lifespan"></div>
    </div>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'fs-person-card',

    properties: {

      /**
       * Person ID
       *
       * @type String
       */
      personId: {
        type: String,
        notify: true,
        observer: '_idChanged',
        reflectToAttribute: true
      },
      
      /**
       * Person
       * 
       * @type Object
       */
      person: {
        type: Object,
        notify: true,
        observer: '_personChanged'
      },
      
      _requested: {
        type: Boolean,
        readOnly: true
      }

    },
    
    behaviors: [FSBehavior],
    
    attached: function() {
      this.loadPerson();
    },
    
    loadPerson: function(){
      var self = this;
      if(!this._requested && this.isAuthenticated() && this.personId){
        this._set_requested(true);
        this.getClient().getPerson(this.personId).then(function(response){
          self.person = response.getPerson();
        });
      }
    },
    
    _authenticatedChanged: function(event){
      if(event.detail.value){
        this.loadPerson();
      }
    },
    
    _idChanged: function(){
      this.loadPerson();
    },
    
    _personChanged: function(person){
      this.$$('.header').textContent = person.getDisplayName();
      this.$$('.pid').textContent = person.getId();
      this.$$('.lifespan').textContent = person.getDisplayLifeSpan();
      this.$$('.loader').style.display = 'none';
      this.$.portrait.person = person;
      this.$.portrait.gender = person.getDisplayGender();
    }

  });

</script>
