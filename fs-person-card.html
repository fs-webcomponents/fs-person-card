<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../fs-client/fs-client.html">
<link rel="import" href="../fs-behavior/fs-behavior.html">
<link rel="import" href="../fs-person-portrait/fs-person-portrait.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-spinner/paper-spinner.html">

<!--
A FamilySearch person card.

Basic example:

    <fs-person-card person-id="PPP-PPPP"></fs-person-card>
    
You can also specify toolbar actions for the paper card:

    <fs-person-card person-id="PPP-PPPP">
      <div class="card-actions">
        <paper-button>Action</paper-button>
        <paper-icon-button icon="favorite"></paper-icon-button>
      </div>
    </fs-person-card>

@group FamilySearch Elements
@element fs-person-card
@demo demo/index.html
-->
<dom-module id="fs-person-card">
  <template>
    <style>
      :host {
        display: block;
        font-family: arial;
        --paper-spinner-layer-1-color: var(--paper-grey-400);
        --paper-spinner-layer-2-color: var(--paper-grey-400);
        --paper-spinner-layer-3-color: var(--paper-grey-400);
        --paper-spinner-layer-4-color: var(--paper-grey-400);
      }
      
      paper-card {
        width: 400px;
        min-height: 100px;
      }
      
      .body {
        position: relative; 
      }
      
      #spinner {
        position: absolute;
        left: 50%;
        top: 10px;
      }
      
      table {
        border-collapse: collapse;
        border-spacing: 0;
      }
      
      .header {
        overflow: auto;
      }
      
      .name {
        font-size: 18px;
        font-weight: bold;
      }
      
      fs-person-portrait {
        float: left;
        margin-right: 16px;
      }
      
      .vitals {
        margin-top: 8px;
      }
      
      .vitals th {
        width: 75px;
        font-weight: normal;
        vertical-align: top;
        text-align: right;
        padding-right: 16px;
        font-size: smaller;
        text-transform: uppercase;
      }
      
      .vitals th,
      .vitals td {
        padding-top: 8px;
      }
    </style>
    <fs-client name="{{clientName}}" on-authenticated-changed="_authenticatedChanged"></fs-client>
    <paper-card>
      <div class="card-content">
        <div class="header">
          <fs-person-portrait id="portrait"></fs-person-portrait>
          <div class="name"></div>
          <div class="details">
            <div class="pid"></div>
          </div>
        </div>
        <div class="body">
          <paper-spinner id="spinner" alt="Loading person details"></paper-spinner>
          <table class="vitals">
            <tr class="birth">
              <th>Birth</th>
              <td>
                <div class="date"></div>
                <div class="place"></div>
              </td>
            </tr>
            <tr class="death">
              <th>Death</th>
              <td>
                <div class="date"></div>
                <div class="place"></div>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <content></content>
    </paper-card>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'fs-person-card',

    properties: {

      /**
       * Person ID
       *
       * @type String
       */
      personId: {
        type: String,
        notify: true,
        observer: '_idChanged',
        reflectToAttribute: true
      },
      
      /**
       * Person
       * 
       * @type Object
       */
      person: {
        type: Object,
        notify: true,
        observer: '_personChanged'
      },
      
      _requested: {
        type: Boolean,
        readOnly: true
      }

    },
    
    behaviors: [FSBehavior],
    
    attached: function() {
      this.loadPerson();
    },
    
    loadPerson: function(){
      var self = this;
      if(!this._requested && this.isAuthenticated() && this.personId){
        this.$.spinner.active = true;
        this._set_requested(true);
        this.getClient().getPerson(this.personId).then(function(response){
          self.person = response.getPerson();
        });
      }
    },
    
    _authenticatedChanged: function(event){
      if(event.detail.value){
        this.loadPerson();
      }
    },
    
    _idChanged: function(){
      this.loadPerson();
    },
    
    _personChanged: function(person){
      this.$.portrait.person = person;
      this.$.portrait.gender = person.getDisplayGender();
      this.$$('.name').textContent = person.getDisplayName();
      this.$$('.pid').textContent = person.getId();
      this.$$('.birth .date').textContent = person.getDisplayBirthDate();
      this.$$('.birth .place').textContent = person.getDisplayBirthPlace();
      this.$$('.death .date').textContent = person.getDisplayDeathDate();
      this.$$('.death .place').textContent = person.getDisplayDeathPlace();
      this.$.spinner.active = false;
    }
    
  });

</script>
